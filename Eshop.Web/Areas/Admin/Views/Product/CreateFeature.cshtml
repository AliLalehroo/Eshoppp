@{
    ViewData["Title"] = "ایجاد ویژگی محصول";
    var productId = (long)ViewData["ProductId"];
}

<div class="row">
    <div class="col-lg-12">
        <div id="addproduct-accordion" class="custom-accordion">
            <div class="card">
                <div class="p-4">
                    <div class="d-flex align-items-center">
                        <div class="flex-shrink-0 me-3">
                            <div class="avatar">
                                <div class="avatar-title font-size-16 rounded-circle bg-soft-primary text-primary">
                                    01
                                </div>
                            </div>
                        </div>
                        <div class="flex-grow-1 overflow-hidden">
                            <h5 class="font-size-16 mb-1">@ViewData["Title"]</h5>
                            <p class="text-muted text-truncate mb-0">لطفا فرم زیر را پر کنید</p>
                        </div>
                    </div>
                </div>
                <div>
                    <div class="p-4 border-top">
                        <form asp-area="Admin" asp-controller="Product" asp-action="CreateFeature" method="post" id="featureForm">
                            <input name="productId" type="hidden" value="@productId" />
                            <div class="row">
                                <div class="col-12">
                                    <div class="table-responsive">
                                        <table class="table" id="featuresTable" style="min-width: 800px">
                                            <thead>
                                                <tr class="table-header-row">
                                                    <th class="radius-td-right">ویژگی</th>
                                                    <th>مقدار</th>
                                                    <th>ترتیب</th>
                                                    <th class="radius-td-left">حذف</th>
                                                </tr>
                                            </thead>
                                            <tbody id="featuresBody">
                                                <tr>
                                                    <td style="width: 30%"><input type="text" name="features[0].Title" class="form-control" placeholder="مثلاً Ram" /></td>
                                                    <td style="width: 50%"><input type="text" name="features[0].Value" class="form-control" placeholder="مثلاً 12GB" /></td>
                                                    <td style="width: 15%"><input type="number" name="features[0].Order" class="form-control" /></td>
                                                    <td style="width: 5%"><button type="button" class="btn btn-danger btn-sm text-light removeRow"><i class="fa fa-trash"></i></button></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <p id="formMessage" class="text-danger my-3" style="display: none"></p>
                                </div>
                                <div class="col-12 mb-3">
                                    <button type="button" id="addRow" class="btn btn-primary"> + افزودن ویژگی</button>
                                </div>
                            </div>
                            <div class="row mb-4">
                                <div class="col">
                                    <button class="btn btn-success"> <i class="mdi mdi-file-document-outline me-1"></i>ذخیره</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section AdminFooterSection
{
    <script>
        let index = 1;

        document.getElementById('addRow').addEventListener('click',
            function() {
                const tbody = document.getElementById('featuresBody');
                const row = document.createElement('tr');

                row.innerHTML = `
                <td style="width: 30%"><input type="text" name="features[${index}].Title" class="form-control" /></td>
                <td style="width: 50%"><input type="text" name="features[${index}].Value" class="form-control"/></td>
                <td style="width: 15%"><input type="number" name="features[${index}].Order" class="form-control"/></td>
                <td style="width: 5%"><button type="button" class="btn btn-danger btn-sm text-light removeRow"><i class="fa fa-trash"></i></button></td>\r\n
            `;
                tbody.appendChild(row);
                index++;
            });

        document.getElementById('featuresTable').addEventListener('click',
            function(e) {
                if (e.target.classList.contains('removeRow')) {
                    e.target.closest('tr').remove();
                }
            });

        document.getElementById('featureForm').addEventListener('submit', function(e) {
            const inputs = this.querySelectorAll('input');
            const messageElement = document.getElementById('formMessage');
            let isValid = true;

            inputs.forEach(input => {
                if (!input.value.trim()) {
                    isValid = false;
                    input.style.border = '2px solid red';
                } else {
                    input.style.border = '';
                }
            });

            if (!isValid) {
                e.preventDefault();
                messageElement.textContent = 'فرم شامل ورودی ای بدون مقدار می باشد.لطفا فرم را به طور کامل پر کنید';
                messageElement.style.display = 'block';
            } else {
                messageElement.style.display = 'none';
            }
        });
    </script>
}
