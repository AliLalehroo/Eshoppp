@using Eshop.Data.Entities.Common
@using Eshop.Web.Extensions
@model Eshop.Data.DTOs.OrderDto.OrderDetailDto
@{
    var info = (SiteInfo)ViewData["SiteInfo"]!;
    Layout = null;
    var index = 1;
}

<!DOCTYPE html>
<html dir="rtl" lang="">
<head>
    <title>چاپ فاکتور فروش</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="/Site/css/bootstrap.min.css">
    <link rel="stylesheet" href="/Site/css/style.css">
    <link rel="stylesheet" href="/Site/css/responsive.css">
</head>
<body class="bg-white">

    <div class="container-xl" style="margin-top: 100px;">
        <div class="row">
            <div class="col-3 text-center"></div>
            <div class="col-6 text-center"><h3 class="font-weight-bold">صورتحساب فروش کالا و خدمات</h3></div>
            <div class="col-3 text-right">
                <p class="text-end">شماره سفارش: @Model.Id</p>
                <p class="text-end">تاریخ سفارش: @Model.PaymentRecord.PaymentTime</p>
            </div>
        </div>
        <div class="row">
            <table class="table">
                <thead>
                    <tr>
                        <th class="text-center" colspan="11">مشخصات فروشنده</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="11" class="text-right">
                            <div class="row">
                                <div class="col-4">
                                    <p>نام شخص حقیق / حقوقی: @info.ShopTitle</p>
                                    <p>آدرس کامل: @info.Address</p>
                                </div>
                                <div class="col-4">
                                    <p>شماره اقتصادی: @info.BusinessId</p>
                                    <p>کد پستی: @info.PostCode</p>
                                </div>
                                <div class="col-4">
                                    <p>شماره ثبت / شناسه ملی: @info.NationalBusinessNumber</p>
                                    <p>تلفن / نمابر: @info.PhoneNumber</p>
                                </div>
                            </div>
                        </td>
                    </tr>
                </tbody>
                <thead>
                    <tr>
                        <th class="text-center" colspan="11">مشخصات خریدار</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="11" class="text-right">
                            <div class="row">
                                <div class="col-4">
                                    <p>نام شخص حقیق / حقوقی: @Model.UserName</p>
                                    <p>آدرس کامل: @ProvinceFinder.GetProvince(Model.DestinationCity) / @Model.DestinationCity @Model.Address</p>
                                </div>
                                <div class="col-4">
                                    <p>شماره تماس: @Model.User.MobileNumber</p>
                                    <p>کد پستی: @Model.PostCode</p>
                                </div>
                                <div class="col-4">
                                    <p>شماره ثبت / شناسه ملی: -</p>
                                    <p>تلفن / نمابر: -</p>
                                </div>
                            </div>
                        </td>
                    </tr>
                </tbody>
                <thead>
                    <tr>
                        <th class="text-center" colspan="11">مشخصات کالا یا خدمات مورد معامله</th>
                    </tr>
                </thead>
                <thead>
                    <tr class="text-center">
                        <th colspan="1">ردیف</th>
                        <th colspan="1">کد کالا</th>
                        <th colspan="3">شرح کالا یا خدمات</th>
                        <th colspan="1">واحد انداز گیری</th>
                        <th colspan="1">تعداد / مقدار</th>
                        <th colspan="1">مبلغ واحد (ریال)</th>
                        <th colspan="1">مبلغ مازاد (ریال)</th>
                        <th colspan="2">مبلغ کل (ریال)</th>
                    </tr>
                </thead>
                <tbody class="print-table">
                    @foreach (var item in Model.OrderDetails.OrderByDescending(o => o.CreateDate))
                    {
                        <tr class="text-center">
                            <td colspan="1">@index</td>
                            <td colspan="1">@item.ProductVariant.ProductId</td>
                            <td colspan="3">@item.ProductVariant.Product.Title</td>
                            <td colspan="1">عدد</td>
                            <td colspan="1">@item.Count</td>
                            <td colspan="1">@((item.ProductPrice * 10).ToString("#,0"))</td>
                            <td colspan="1">@((item.VariantPrice * 10).ToString("#,0"))</td>
                            <td colspan="2">@((item.TotalPrice * 10).ToString("#,0"))</td>
                        </tr>
                        index++;
                    }
                    <tr>
                        <th colspan="6" class="text-right">جمع کل</th>
                        <th colspan="1" class="text-center">@(Model.OrderDetails.Sum(d => d.Count)) عدد</th>
                        <th colspan="1" class="text-center">@(((Model.OrderDetails.Sum(d => d.ProductPrice)) * 10).ToString("#,0"))</th>
                        <th colspan="1" class="text-center">@(((Model.OrderDetails.Sum(d => d.VariantPrice)) * 10).ToString("#,0"))</th>
                        <th colspan="1" class="text-center">@(((Model.OrderDetails.Sum(d => d.TotalPrice)) * 10).ToString("#,0"))</th>
                    </tr>
                    <tr>
                        <td colspan="5" class="text-right">
                            شرایط و نحوه فروش: &nbsp&nbsp&nbsp&nbsp نقدی
                        </td>
                        <td colspan="2" class="text-right"><strong>پرداخت شده</strong></td>
                        <td colspan="2" class="text-right">تاریخ پرداخت : @Model.PaymentRecord.PaymentTime</td>
                        <td colspan="2" class="text-right">شناسه پرداخت : @Model.BankTraceCode</td>
                    </tr>
                    <tr style="padding: 60px 0;">
                        <td>توضیحات :</td>
                    </tr>
                    <tr style="padding: 60px 0;">
                        <td colspan="5" class="text-right">مهر و امضا فروشنده</td>
                        <td colspan="6" class="text-right">مهر و امضا خریدار</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <a href="" class="btn btn-dark" id="printPageButton" onclick="printInvoice()">پرینت</a>

    </div>


    <script src="/Site/js/jquery-3.7.1.min.js"></script>
    <script src="/Site/js/bootstrap.bundle-5.3.2.min.js"></script>
    <script src="/Site/js/app.js"></script>
    <script src="/Site/js/modernizr-3.11.2.min.js"></script>

    <script>
        function printInvoice() {
            window.print();
        }
    </script>
</body>
</html>

