@using Eshop.Application.Utils
@using Eshop.Data.DTOs.ProductDto
@model Eshop.Data.DTOs.ProductDto.ProductDetailDto
@{
    ViewData["Title"] = "جزئیات محصول";
}

<div class="row">
    <div class="col-lg-12">
        <div class="card">
            <div class="card-body">
                <div class="row">
                    <div class="col-xl-4">
                        <div class="product-detail mt-3" dir="ltr">
                            <!-- Main Image & Gallery Images-->
                            <div class="swiper product-thumbnail-slider rounded border overflow-hidden position-relative">
                                <div class="swiper-wrapper">
                                    <div class="swiper-slide">
                                        <img src="@(PathExtension.ProductImageImage + Model.MainImageName)" class="img-fluid d-block" alt="">
                                    </div>
                                    @if (Model.ProductGalleries.Any())
                                    {
                                        foreach (var gallery in Model.ProductGalleries.OrderBy(g => g.Order))
                                        {
                                            <div class="swiper-slide"><img src="@(PathExtension.ProductGalleryImage + gallery.ImageName)" alt="" class="img-fluid d-block"></div>
                                        }
                                    }
                                </div>
                                @if (Model.ProductGalleries.Any())
                                {
                                    <div class="d-none d-md-block">
                                        <div class="swiper-button-next"></div>
                                        <div class="swiper-button-prev"></div>
                                    </div>
                                }
                            </div>
                            @if (Model.ProductGalleries.Any())
                            {
                                <div class="mt-4">
                                    <div thumbsslider="" class="swiper product-nav-slider mt-2 overflow-hidden">
                                        <div class="swiper-wrapper">
                                            <div class="swiper-slide rounded">
                                                <div class="nav-slide-item">
                                                    <img src="@(PathExtension.ProductImageImage + Model.MainImageName)" class="img-fluid d-block rounded" alt="">
                                                </div>
                                            </div>

                                            @foreach (var gallery in Model.ProductGalleries.OrderBy(g => g.Order))
                                            {
                                                <div class="swiper-slide">
                                                    <div class="nav-slide-item">
                                                        <img src="@(PathExtension.ProductGalleryThumb + gallery.ImageName)" class="img-fluid d-block rounded" alt="">
                                                    </div>
                                                </div>
                                            }
                                        </div>
                                    </div>
                                </div>
                            }

                        </div>
                    </div>
                    <div class="col-xl-8">
                        <div class="mt-3 mt-xl-3 ps-xl-5">
                            <h3 class="font-size-20 mb-3">@Model.Title</h3>

                            <h5 class="mb-0 mt-4">@Model.BasePrice.ToRial()</h5>

                            <p class="mt-4">
                                دسته بندی ها:
                                @foreach (var selectedCategory in Model.SelectedCategories)
                                {
                                    <span class="product-detail-category-item">@selectedCategory.Category.Title</span>
                                }
                            </p>

                            @if (Model.ProductSelectedBrand != null)
                            {
                                <p class="mt-4 text-muted">برند : @Model.ProductSelectedBrand.Title</p>
                            }

                            <div>
                                <div class="row">
                                    <div class="col-12 text-muted">
                                        <p>شناسه ی محصول : @Model.Id</p>
                                        <p>تاریخ ایجاد : @Model.CreateDate.ToShamsiDate() - @Model.CreateDate.ToString("HH:mm")</p>
                                        <p>تاریخ آخرین ویرایش : @Model.LastUpdateDate.ToShamsiDate() - @Model.CreateDate.ToString("HH:mm")</p>
                                    </div>

                                    <div class="col-lg-12">
                                        <a asp-area="Admin" asp-controller="Product" asp-action="EditProduct"
                                           asp-route-productId="@Model.Id" class="btn btn-warning">ویرایش محصول</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- end row -->

                <div class="row">
                    <div class="col-12">
                        <div class="product-desc mt-4 pt-3">
                            <ul class="nav nav-tabs nav-tabs-custom" role="tablist">
                                <li class="nav-item">
                                    <a class="nav-link active" id="variant-tab" data-bs-toggle="tab" href="#variant" role="tab">موجودی محصول</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="features-tab" data-bs-toggle="tab" href="#features" role="tab">ویژگی های محصول</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="gallery-tab" data-bs-toggle="tab" href="#gallery" role="tab">گالری محصول</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="desc-tab" data-bs-toggle="tab" href="#desc" role="tab">توضیحات</a>
                                </li>
                            </ul>
                            <div class="tab-content border border-top-0 p-4">
                                <!-- Product Variants -->
                                <div class="tab-pane fade show active" id="variant" role="tabpanel">
                                    <div class="row">
                                        <div class="col-12">
                                            <div class="mb-2">
                                                <a asp-area="Admin" asp-controller="Product" asp-action="CreateVariant"
                                                   asp-route-productId="@Model.Id" class="btn btn-success">ایجاد موجودی</a>
                                            </div>

                                            <table class="table table-bordered">
                                                <tr class="table-header-row">
                                                    <th class="radius-td-right">#</th>
                                                    <th>رنگ</th>
                                                    <th>قیمت</th>
                                                    <th>موجودی</th>
                                                    <th class="radius-td-left">عملیات</th>
                                                </tr>
                                                @if (Model.ProductVariants.Any())
                                                {
                                                    var index = 1;
                                                    @foreach (var item in Model.ProductVariants.OrderByDescending(v => v.StockCount))
                                                    {
                                                        <tr>
                                                            <td>@index</td>
                                                            <td><i class="mdi mdi-circle font-size-18" style="color: @item.ColorCode"></i> @item.ColorTitle</td>
                                                            @if (item.Price > 0)
                                                            {
                                                                var price = Model.BasePrice + item.Price;
                                                                <td>@price.ToRial()</td>
                                                            }
                                                            else
                                                            {
                                                                <td>قیمت پایه</td>
                                                            }

                                                            <td>@item.StockCount.ToString("#,0")</td>
                                                            <td>
                                                                <div>
                                                                    <a asp-area="Admin" asp-controller="Product" asp-action="EditVariant"
                                                                       asp-route-productId="@Model.Id" asp-route-variantId="@item.Id" class="btn btn-warning btn-sm">ویرایش</a>
                                                                    <a href="#" data-bs-toggle="modal" data-bs-target="#deleteVariantModal-@item.Id"
                                                                       class="btn btn-sm btn-danger">حذف</a>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        index++;
                                                    }
                                                }

                                            </table>
                                            @if (!Model.ProductVariants.Any())
                                            {
                                                <div class="alert alert-info">
                                                    <p class="mb-0">موجودی ای برای محصول تعریف نشده است</p>
                                                </div>
                                            }
                                        </div>
                                    </div>
                                </div>
                                <!-- Product Features -->
                                <div class="tab-pane fade " id="features" role="tabpanel">
                                    <div class="mb-2">
                                        <a asp-area="Admin" asp-controller="Product" asp-action="CreateFeature"
                                           asp-route-productId="@Model.Id" class="btn btn-success">ایجاد ویژگی</a>
                                    </div>
                                    <div class="table-responsive">
                                        <table class="table table-nowrap mb-0">
                                            @if (Model.ProductFeatures.Any())
                                            {
                                                <tbody>
                                                    @foreach (var feature in Model.ProductFeatures.OrderBy(f => f.Order))
                                                    {
                                                        <tr>
                                                            <th scope="row">@feature.Order) @feature.Title</th>
                                                            <td>@feature.Value</td>
                                                            <td>
                                                                <div>
                                                                    <a href="#" data-bs-toggle="modal" data-bs-target="#editFeatureModal-@feature.Id"
                                                                       class="btn btn-sm btn-warning">ویرایش</a>
                                                                    <a href="#" data-bs-toggle="modal" data-bs-target="#deleteFeatureModal-@feature.Id"
                                                                       class="btn btn-sm btn-danger">حذف</a>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                    }
                                                </tbody>
                                            }
                                            else
                                            {
                                                <div class="alert alert-info">
                                                    <p class="mb-0">ویژگی ای برای محصول تعریف نشده است</p>
                                                </div>
                                            }
                                        </table>
                                    </div>
                                </div>
                                <!-- Product Galleries -->
                                <div class="tab-pane fade" id="gallery" role="tabpanel">
                                    <div class="row">
                                        <div class="col-12">
                                            <a data-bs-toggle="modal" data-bs-target="#createGalleryModal" class="btn btn-success">ایجاد تصویر گالری</a>
                                            <div class="row">
                                                @if (Model.ProductGalleries.Any())
                                                {
                                                    @foreach (var gallery in Model.ProductGalleries.OrderBy(g => g.Order))
                                                    {
                                                        <div class="col-12 col-md-4 col-lg-2">
                                                            <img src="@(PathExtension.ProductGalleryThumb + gallery.ImageName)" class="img-fluid product-detail-gallery-item" alt="" />
                                                            <div class="">
                                                                <div>
                                                                    <p>
                                                                        @gallery.Order)
                                                                        <a href="#" data-bs-toggle="modal" data-bs-target="#editGalleryModal-@gallery.Id"
                                                                           class="btn btn-sm btn-warning">ویرایش</a>
                                                                        <a href="#" data-bs-toggle="modal" data-bs-target="#deleteGalleryModal-@gallery.Id"
                                                                           class="btn btn-sm btn-danger">حذف</a>
                                                                    </p>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    }
                                                }
                                                else
                                                {
                                                    <div class="alert alert-info">
                                                        <p class="mb-0">تصویر گالری برای محصول تعریف نشده است</p>
                                                    </div>
                                                }
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Product Descriptions -->
                                <div class="tab-pane fade" id="desc" role="tabpanel">
                                    <div class="row">
                                        <h5>توضیحات کوتاه</h5>
                                        @if (Model.ShortDescription != null)
                                        {
                                            <div class="desc-text">
                                                @Html.Raw(Model.ShortDescription)
                                            </div>
                                        }
                                        else
                                        {
                                            <div class="alert alert-info">
                                                <p class="mb-0">توضیحات کوتاه برای محصول تعریف نشده است</p>
                                            </div>
                                        }
                                        <hr />
                                        <h5>توضیحات اصلی</h5>
                                        @if (Model.Description != null)
                                        {
                                            <div class="desc-text">
                                                @Html.Raw(Model.Description)
                                            </div>
                                        }
                                        else
                                        {
                                            <div class="alert alert-info">
                                                <p class="mb-0">توضیحاتی برای محصول تعریف نشده است</p>
                                            </div>
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@if (Model.ProductVariants.Any())
{
    @foreach (var item in Model.ProductVariants)
    {
        <!-- Delete Variant Modal -->
        <div class="modal fade" id="deleteVariantModal-@item.Id" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" role="dialog" aria-labelledby="staticBackdropLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="staticBackdropLabel">تایید حذف</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="بستن"></button>
                    </div>
                    <div class="modal-body">
                        <p>آیا از حذف @item.ColorTitle مطمئن هستید ؟</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-light" data-bs-dismiss="modal">خیر</button>
                        <a asp-area="Admin" asp-controller="Product" asp-action="DeleteVariant"
                           asp-route-productId="@Model.Id" asp-route-variantId="@item.Id" class="btn btn-primary">بله</a>
                    </div>
                </div>
            </div>
        </div>
    }
}


@if (Model.ProductFeatures.Any())
{
    @foreach (var item in Model.ProductFeatures)
    {
        <!-- Delete Gallery Modal -->
        <div class="modal fade" id="deleteFeatureModal-@item.Id" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" role="dialog" aria-labelledby="staticBackdropLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="staticBackdropLabel">تایید حذف</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="بستن"></button>
                    </div>
                    <div class="modal-body">
                        <p>آیا از حذف این وِیژگی محصول مطمئن هستید ؟</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-light" data-bs-dismiss="modal">خیر</button>
                        <a asp-area="Admin" asp-controller="Product" asp-action="DeleteFeature"
                           asp-route-featureId="@item.Id" asp-route-productId="@Model.Id" class="btn btn-primary">بله</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Edit Feature Modal-->
        <div class="modal fade" id="editFeatureModal-@item.Id" tabindex="-1" role="dialog" aria-labelledby="exampleModalScrollableTitle" aria-hidden="true">
            <div class="modal-dialog modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalScrollableTitle">ویرایش ویژگی محصول</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="بستن"></button>
                    </div>
                    <form asp-area="Admin" asp-controller="Product" asp-action="EditFeature" method="post">
                        <div class="modal-body">
                            <!-- Edit Feature Partial-->
                            <partial name="_EditFeaturePartial" model="@new EditFeaturesDto{ Order = @item.Order , Title = @item.Title , Value = @item.Value , FeatureId = @item.Id , ProductId = @Model.Id }" />
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-light" data-bs-dismiss="modal">بستن</button>
                            <button type="submit" class="btn btn-primary">ذخیره</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    }
}


@if (Model.ProductGalleries.Any())
{
    @foreach (var item in Model.ProductGalleries)
    {
        <!-- Delete Gallery Modal -->
        <div class="modal fade" id="deleteGalleryModal-@item.Id" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" role="dialog" aria-labelledby="staticBackdropLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="staticBackdropLabel">تایید حذف</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="بستن"></button>
                    </div>
                    <div class="modal-body">
                        <p>آیا از حذف این تصویر گالری محصول مطمئن هستید ؟</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-light" data-bs-dismiss="modal">خیر</button>
                        <a asp-area="Admin" asp-controller="Product" asp-action="DeleteGallery"
                           asp-route-productId="@Model.Id" asp-route-galleryId="@item.Id" class="btn btn-primary">بله</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Edit Gallery Modal-->
        <div class="modal fade" id="editGalleryModal-@item.Id" tabindex="-1" role="dialog" aria-labelledby="exampleModalScrollableTitle" aria-hidden="true">
            <div class="modal-dialog modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalScrollableTitle">ویرایش تصویر گالری</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="بستن"></button>
                    </div>
                    <form asp-area="Admin" asp-controller="Product" asp-action="EditGallery" method="post">
                        <div class="modal-body">
                            <!-- Edit Gallery Partial-->
                            <partial name="_EditGalleryPartial" model="@new EditGalleryDto{ Order = @item.Order , GalleryId = @item.Id , ProductId = @Model.Id }" />
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-light" data-bs-dismiss="modal">بستن</button>
                            <button type="submit" class="btn btn-primary">ذخیره</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    }
}


<!-- Create Gallery Modal-->
<div class="modal fade" id="createGalleryModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalScrollableTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalScrollableTitle">ایجاد تصویر گالری</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="بستن"></button>
            </div>
            <form asp-area="Admin" asp-controller="Product" asp-action="CreateGallery" enctype="multipart/form-data" method="post">
                <div class="modal-body">
                    <!-- Create Gallery Partial-->
                    <partial name="_CreateGalleryPartial" model="@new CreateGalleryDto{ ProductId = @Model.Id }" />
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">بستن</button>
                    <button type="submit" class="btn btn-primary">ذخیره</button>
                </div>
            </form>
        </div>
    </div>
</div>

@section AdminFooterSection
{
    <script src="/Admin/libs/swiper/swiper-bundle.min.js"></script>
    <script src="/Admin/js/pages/ecommerce-product-detail.init.js"></script>
    <script src="/Admin/js/productactions.js"></script>
    <script>
        updateFileList("GalleryImage", "fileList1");
    </script>
}

@section AdminHeaderSection
{
    <link rel="stylesheet" href="/Admin/libs/swiper/swiper-bundle.min.css">
}
