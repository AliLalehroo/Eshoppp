@using Eshop.Application.Utils
@using Eshop.Data.Entities.Account
@using Eshop.Web.Extensions
@using Microsoft.AspNetCore.Mvc.TagHelpers
@model Eshop.Data.DTOs.OrderDto.OpenOrderDto
@{
    ViewData["Title"] = "صورتحساب";
    var user = (User)ViewData["User"];
}
<section class="content">
    <div class="container-fluid">
        <div class="payment_navigtions">
            <div class="checkout-headers">
                <nav class="navbar navbar-expand">
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a asp-area="User" asp-controller="Order" asp-action="Cart" class="nav-link">
                                <span>1</span>
                                <p>سبد خرید</p>
                            </a>
                        </li>
                        <li class="nav-item active">
                            <a href="" class="nav-link">
                                <span>2</span>
                                <p>صورتحساب</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="" class="nav-link">
                                <span>3</span>
                                <p>جزییات پرداخت</p>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </div>
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-9">
                <div class="content-box">
                    <div class="detail-order mb-4">
                        <div class="detail-order-item mt-3 d-flex align-items-center">
                            <h6><i class="bi bi-person-fill me-1"></i>تحویل گیرنده:</h6>
                            @if (user.FullName != null)
                            {
                                <span class="ms-2 text-muted">@user.FullName</span>
                            }
                            else
                            {
                                <span class="ms-2 text-danger">تعیین نشده</span>
                            }
                        </div>
                        <div class="detail-order-item d-flex align-items-center">
                            <h6><i class="bi bi-telephone-fill me-1"></i>شماره تماس:</h6>
                            <span class="ms-2 text-muted">@user.MobileNumber</span>
                        </div>
                        <div class="detail-order-item d-flex align-items-center">
                            <h6><i class="bi bi-pin-map-fill me-1"></i> شهر محل تحویل:</h6>
                            @if (user.UserCity != null)
                            {
                                <span class="ms-2 text-muted">@ProvinceFinder.GetProvince(user.UserCity) / @user.UserCity</span>
                            }
                            else
                            {
                                <span class="ms-2 text-danger">تعیین نشده</span>
                            }
                        </div>
                        <div class="detail-order-item d-flex align-items-center">
                            <h6><i class="bi bi-pin-map-fill me-1"></i> آدرس تحویل:</h6>
                            @if (user.Address != null)
                            {
                                <span class="ms-2 text-muted">@user.Address</span>
                            }
                            else
                            {
                                <span class="ms-2 text-danger">تعیین نشده</span>
                            }
                        </div>
                        <div class="detail-order-item d-flex align-items-center">
                            <h6><i class="bi bi-pin-map-fill me-1"></i>کد پستی:</h6>
                            @if (user.PostCode != null)
                            {
                                <span class="ms-2 text-muted">@user.PostCode</span>
                            }
                            else
                            {
                                <span class="ms-2 text-danger">تعیین نشده</span>
                            }
                        </div>
                        <a asp-area="User" asp-controller="Account" asp-action="EditUserDetail" class="btn mt-3 btn-dark btn-sm">ویرایش</a>
                    </div>
                    <div class="cart-product-item my-5">
                        <div class="row">
                            @foreach (var detail in Model.OrderDetails)
                            {
                                <div class="col-lg-3">
                                    <div class="cart-items border-end">
                                        <div class="item">
                                            <a asp-area="" asp-controller="Product" asp-action="ProductDetail"
                                               asp-route-productId="@detail.ProductVariant.ProductId">
                                                <div class="image text-start">
                                                    <img src="@(PathExtension.ProductImageImage + detail.ProductVariant.Product.MainImageName)" alt=""
                                                         class="img-fluid d-inline-block w-100-px">
                                                </div>
                                            </a>
                                            <div class="d-flex justify-content-between align-items-md-start align-items-end flex-wrap">
                                                <div class="d-flex align-items-start flex-column me-2">
                                                    <div class="cart-item-feature d-flex flex-column align-items-start flex-wrap mt-3">
                                                        <div class="item d-flex align-items-center">
                                                            <div class="icon"><i class="bi bi-palette"></i></div>
                                                            <div class="mx-2">رنگ:</div>
                                                            <div class="text-muted">@detail.ProductVariant.ColorTitle</div>
                                                        </div>
                                                        <div class="item d-flex align-items-center mt-2">
                                                            <div class="icon">
                                                                <i class="bi bi-shield-check"></i>
                                                            </div>
                                                            <div class="mx-2">تعداد :</div>
                                                            <div class="text-muted">@detail.Count</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-6 col-lg-3">
                            <div class="text-start">
                                <div class="slider-title-desc mb-4">
                                    <div class="slider-title-title">
                                        <h2 class="h4 icon-circle">
                                            شیوه<span class="main-color-one-color fw-bold"> پرداخت </span>
                                        </h2>
                                    </div>
                                </div>
                                <div class="image-selector">
                                    <nav class="navbar navbar-expand">
                                        <ul class="navbar-nav">
                                            <li class="nav-item">
                                                <input type="radio" checked="" name="send" id="cb22">
                                                <label for="cb22" class="d-inline-block border border-2">
                                                    <span class="send-item active">
                                                        <span class=" d-block fw-bold h6 text-center">پرداخت مستقیم</span>
                                                    </span>
                                                </label>
                                            </li>
                                        </ul>
                                    </nav>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-6 col-lg-3">
                            <div class="slider-title-desc mb-4">
                                <div class="slider-title-title">
                                    <h2 class="h4 icon-circle">
                                        انتخاب<span class="main-color-one-color fw-bold"> درگاه </span>
                                    </h2>
                                </div>
                            </div>
                            <div class="delivary-payment-bank mt-3 flex-wrap d-flex align-items-center">
                                <div class="image-selector">
                                    <nav class="navbar navbar-expand">
                                        <ul class="navbar-nav">
                                            <li class="nav-item">
                                                <input type="radio" checked="" name="test" id="cb2">
                                                <label for="cb2"><img src="/Site/image/test.jpg" alt=""></label>
                                            </li>
                                        </ul>
                                    </nav>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-3">
                <div class="cart-canvases position-sticky top-0">
                    <div class="item">
                        <div class="factor">
                            <div class="d-flex factor-item mb-3 align-items-center justify-content-between">
                                <h5 class="title-font mb-0 h6">هزینه ارسال</h5>
                                <p class="mb-0 font-17">به صورت پس کرایه</p>
                            </div>

                            <div class="d-flex factor-item mb-3 align-items-center justify-content-between">
                                <h5 class="title-font mb-0 h6">مجموع</h5>
                                <p class="mb-0 font-18">@Model.TotalCartPrice().ToString("#,0") تومان</p>
                            </div>

                            <div class="action mt-3 d-flex align-items-center justify-content-center">
                                <a asp-area="User" asp-controller="Payment" asp-action="PayOrder"
                                   class="btn main-color-one-bg py-2 rounded-pill rounded-3 d-block w-100">پرداخت</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

